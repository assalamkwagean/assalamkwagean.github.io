<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabungan Santri - Login</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="login-card">
            <div class="logo-section">
                <div class="logo">
                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                        <circle cx="30" cy="30" r="28" fill="#4F46E5" opacity="0.1"/>
                        <path d="M30 15C21.716 15 15 21.716 15 30C15 38.284 21.716 45 30 45C38.284 45 45 38.284 45 30C45 21.716 38.284 15 30 15ZM30 27C31.657 27 33 28.343 33 30C33 31.657 31.657 33 30 33C28.343 33 27 31.657 27 30C27 28.343 28.343 27 30 27Z" fill="#4F46E5"/>
                    </svg>
                </div>
                <h1>Tabungan Santri</h1>
                <p class="subtitle">Masuk ke akun Anda</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="identifier">NIS / Email</label>
                    <input type="text" id="identifier" required placeholder="Masukkan NIS atau Email">
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required placeholder="Masukkan password">
                </div>

                <button type="submit" class="btn btn-primary" id="loginBtn">
                    <span class="btn-text">Masuk</span>
                    <span class="spinner" style="display: none;"></span>
                </button>

                <div id="errorMessage" class="error-message" style="display: none;"></div>
            </form>

            <div class="footer-text">
                <p>Untuk bantuan, hubungi administrator</p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const errorMessage = document.getElementById('errorMessage');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const identifier = document.getElementById('identifier').value;
            const password = document.getElementById('password').value;

            // Show loading
            loginBtn.disabled = true;
            loginBtn.querySelector('.btn-text').style.display = 'none';
            loginBtn.querySelector('.spinner').style.display = 'inline-block';
            errorMessage.style.display = 'none';

            try {
                const response = await fetch(`${API_URL}?action=login`, {
                    method: 'POST',
                    body: JSON.stringify({ identifier, password })
                });

                const result = await response.json();

                if (result.success) {
                    // Simpan data user
                    localStorage.setItem('userData', JSON.stringify(result.data));
                    localStorage.setItem('userType', result.userType);

                    // Redirect berdasarkan user type
                    switch(result.userType) {
                        case 'admin':
                            window.location.href = 'admin.html';
                            break;
                        case 'santri':
                            window.location.href = 'santri.html';
                            break;
                        case 'pembimbing':
                            window.location.href = 'pembimbing.html';
                            break;
                    }
                } else {
                    errorMessage.textContent = result.message;
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                errorMessage.textContent = 'Terjadi kesalahan koneksi';
                errorMessage.style.display = 'block';
            } finally {
                loginBtn.disabled = false;
                loginBtn.querySelector('.btn-text').style.display = 'inline';
                loginBtn.querySelector('.spinner').style.display = 'none';
            }
        });
    </script>
</body>
</html>